# DevOps Templates and Configurations

# Docker
docker:
  generic:
    dockerfile: |
      # Build stage
      FROM alpine:latest

      WORKDIR /app

      # Copy your application files
      COPY . .

      # Install dependencies and build if needed
      # RUN your-build-commands

      EXPOSE 8080

      CMD ["sh", "-c", "echo 'Configure your application start command'"]

    dockerignore: |
      # Version control
      .git/
      .gitignore
      .gitattributes

      # CI/CD
      .github/
      .gitlab-ci.yml
      .travis.yml

      # IDE
      .vscode/
      .idea/
      *.swp
      *.swo

      # OS
      .DS_Store
      Thumbs.db

      # Build artifacts
      build/
      dist/
      *.exe

      # Docs
      docs/
      *.md
      !README.md

      # Tests
      tests/
      test/
      **/*_test.*
      **/*.test.*

      # Misc
      .env*
      !.env.example

  nodejs:
    dockerfile: |
      # Build stage
      FROM node:18-alpine AS builder

      WORKDIR /app

      # Copy package files
      COPY package*.json ./

      # Install dependencies
      RUN npm ci --only=production

      # Copy source code
      COPY . .

      # Build application
      RUN npm run build

      # Production stage
      FROM node:18-alpine

      WORKDIR /app

      # Copy from builder
      COPY --from=builder /app/dist ./dist
      COPY --from=builder /app/node_modules ./node_modules
      COPY --from=builder /app/package.json ./

      # Create non-root user
      RUN addgroup -g 1001 -S nodejs && \
          adduser -S nodejs -u 1001

      USER nodejs

      EXPOSE 3000

      CMD ["node", "dist/index.js"]

    dockerignore: |
      # Dependencies
      node_modules/
      npm-debug.log*
      yarn-error.log*
      pnpm-debug.log*

      # Build
      dist/
      build/
      .next/

      # Environment
      .env*
      !.env.example

      # Git
      .git/
      .gitignore

      # IDE
      .vscode/
      .idea/

      # Testing
      coverage/
      .nyc_output/
      test/
      tests/
      **/*.test.js
      **/*.test.ts

      # Misc
      *.md
      !README.md
      .DS_Store

  go:
    dockerfile: |
      # Build stage
      FROM golang:1.21-alpine AS builder

      WORKDIR /app

      # Copy go mod files
      COPY go.mod go.sum ./
      RUN go mod download

      # Copy source code
      COPY . .

      # Build
      RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o main ./cmd/app

      # Production stage
      FROM alpine:latest

      RUN apk --no-cache add ca-certificates

      WORKDIR /root/

      # Copy binary from builder
      COPY --from=builder /app/main .

      EXPOSE 8080

      CMD ["./main"]

    dockerignore: |
      # Build
      build/
      *.exe
      *.test
      *.out

      # Dependencies
      vendor/

      # Git
      .git/
      .gitignore

      # IDE
      .vscode/
      .idea/

      # Testing
      coverage.txt
      coverage.html
      **/*_test.go

      # Misc
      *.md
      !README.md
      .DS_Store

# Docker Compose
docker_compose:
  basic: |
    version: '3.8'

    services:
      app:
        build:
          context: .
          dockerfile: Dockerfile
        ports:
          - "3000:3000"
        environment:
          - NODE_ENV=production
        restart: unless-stopped

  with_db: |
    version: '3.8'

    services:
      app:
        build:
          context: .
          dockerfile: Dockerfile
        ports:
          - "3000:3000"
        environment:
          - NODE_ENV=production
          - DATABASE_URL=postgresql://user:password@db:5432/mydb
        depends_on:
          - db
        restart: unless-stopped

      db:
        image: postgres:15-alpine
        environment:
          - POSTGRES_USER=user
          - POSTGRES_PASSWORD=password
          - POSTGRES_DB=mydb
        volumes:
          - postgres_data:/var/lib/postgresql/data
        restart: unless-stopped

    volumes:
      postgres_data:

cicd:
  github_actions:
    nodejs: |
      name: CI/CD

      on:
        push:
          branches: [main, develop]
        pull_request:
          branches: [main]

      jobs:
        test:
          runs-on: ubuntu-latest

          strategy:
            matrix:
              node-version: [16.x, 18.x, 20.x]

          steps:
            - uses: actions/checkout@v4

            - name: Setup Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v4
              with:
                node-version: ${{ matrix.node-version }}
                cache: 'npm'

            - name: Install dependencies
              run: npm ci

            - name: Run linter
              run: npm run lint

            - name: Run tests
              run: npm test

            - name: Build
              run: npm run build

        deploy:
          needs: test
          runs-on: ubuntu-latest
          if: github.ref == 'refs/heads/main'

          steps:
            - uses: actions/checkout@v4

            - name: Deploy
              run: echo "Add your deployment steps here"

    go: |
      name: CI/CD

      on:
        push:
          branches: [main, develop]
        pull_request:
          branches: [main]

      jobs:
        test:
          runs-on: ubuntu-latest

          strategy:
            matrix:
              go-version: [1.21.x, 1.22.x]

          steps:
            - uses: actions/checkout@v4

            - name: Setup Go ${{ matrix.go-version }}
              uses: actions/setup-go@v4
              with:
                go-version: ${{ matrix.go-version }}

            - name: Install dependencies
              run: go mod download

            - name: Run tests
              run: go test -v -race ./...

            - name: Run linter
              uses: golangci/golangci-lint-action@v3
              with:
                version: latest

            - name: Build
              run: go build -v ./...

        deploy:
          needs: test
          runs-on: ubuntu-latest
          if: github.ref == 'refs/heads/main'

          steps:
            - uses: actions/checkout@v4

            - name: Deploy
              run: echo "Add your deployment steps here"

    generic: |
      name: CI/CD

      on:
        push:
          branches: [main, develop]
        pull_request:
          branches: [main]

      jobs:
        test:
          runs-on: ubuntu-latest

          steps:
            - uses: actions/checkout@v4

            - name: Run tests
              run: echo "Add your test commands here"

            - name: Build
              run: echo "Add your build commands here"

        deploy:
          needs: test
          runs-on: ubuntu-latest
          if: github.ref == 'refs/heads/main'

          steps:
            - uses: actions/checkout@v4

            - name: Deploy
              run: echo "Add your deployment steps here"

  gitlab_ci:
    nodejs: |
      stages:
        - test
        - build
        - deploy

      variables:
        NODE_VERSION: "18"

      cache:
        paths:
          - node_modules/

      test:
        stage: test
        image: node:${NODE_VERSION}
        script:
          - npm ci
          - npm run lint
          - npm test
        only:
          - merge_requests
          - main
          - develop

      build:
        stage: build
        image: node:${NODE_VERSION}
        script:
          - npm ci
          - npm run build
        artifacts:
          paths:
            - dist/
        only:
          - main
          - develop

      deploy:
        stage: deploy
        script:
          - echo "Add your deployment steps here"
        only:
          - main
        when: manual

    go: |
      stages:
        - test
        - build
        - deploy

      variables:
        GO_VERSION: "1.21"

      cache:
        paths:
          - .cache

      test:
        stage: test
        image: golang:${GO_VERSION}
        script:
          - go mod download
          - go test -v -race ./...
          - go vet ./...
        only:
          - merge_requests
          - main
          - develop

      build:
        stage: build
        image: golang:${GO_VERSION}
        script:
          - go mod download
          - go build -v ./...
        artifacts:
          paths:
            - build/
        only:
          - main
          - develop

      deploy:
        stage: deploy
        script:
          - echo "Add your deployment steps here"
        only:
          - main
        when: manual

    generic: |
      stages:
        - test
        - build
        - deploy

      test:
        stage: test
        script:
          - echo "Add your test commands here"
        only:
          - merge_requests
          - main
          - develop

      build:
        stage: build
        script:
          - echo "Add your build commands here"
        only:
          - main
          - develop

      deploy:
        stage: deploy
        script:
          - echo "Add your deployment steps here"
        only:
          - main
        when: manual