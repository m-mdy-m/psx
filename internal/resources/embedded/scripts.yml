# Scripts Templates

# Install script
install:
  unix: |
    #!/usr/bin/env bash
    # Install script for {{project_name}}

    set -e

    # Colors
    RED='\033[0;31m'
    GREEN='\033[0;32m'
    YELLOW='\033[1;33m'
    NC='\033[0m' # No Color

    echo -e "${GREEN}Installing {{project_name}}...${NC}"

    # Check requirements
    if ! command -v git &> /dev/null; then
        echo -e "${RED}Error: git is not installed${NC}"
        exit 1
    fi

    # Clone repository
    echo "Cloning repository..."
    git clone {{repo_url}}
    cd {{project_name}}

    # Install dependencies
    echo "Installing dependencies..."
    {{install_command}}

    echo -e "${GREEN}✓ Installation complete!${NC}"
    echo ""
    echo "To get started:"
    echo "  cd {{project_name}}"
    echo "  {{start_command}}"

# Setup script
setup:
  nodejs: |
    #!/usr/bin/env bash
    # Setup script for development environment

    set -e

    echo "Setting up development environment..."

    # Check Node.js
    if ! command -v node &> /dev/null; then
        echo "Error: Node.js is not installed"
        exit 1
    fi

    # Check npm
    if ! command -v npm &> /dev/null; then
        echo "Error: npm is not installed"
        exit 1
    fi

    # Install dependencies
    echo "Installing dependencies..."
    npm install

    # Setup git hooks
    if [ -d ".husky" ]; then
        echo "Setting up git hooks..."
        npm run prepare
    fi

    # Copy environment file
    if [ ! -f ".env" ] && [ -f ".env.example" ]; then
        echo "Creating .env file..."
        cp .env.example .env
        echo "⚠️  Please update .env with your configuration"
    fi

    echo "✓ Setup complete!"
    echo ""
    echo "Run 'npm run dev' to start development server"

  go: |
    #!/usr/bin/env bash
    # Setup script for development environment

    set -e

    echo "Setting up development environment..."

    # Check Go
    if ! command -v go &> /dev/null; then
        echo "Error: Go is not installed"
        exit 1
    fi

    # Install dependencies
    echo "Installing dependencies..."
    go mod download

    # Install tools
    echo "Installing development tools..."
    go install golang.org/x/tools/cmd/goimports@latest
    go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest

    # Copy environment file
    if [ ! -f ".env" ] && [ -f ".env.example" ]; then
        echo "Creating .env file..."
        cp .env.example .env
        echo "⚠️  Please update .env with your configuration"
    fi

    echo "✓ Setup complete!"
    echo ""
    echo "Run 'make dev' or 'go run .' to start"

# Test script
test:
  unix: |
    #!/usr/bin/env bash
    # Run tests

    set -e

    echo "Running tests..."

    # Run tests
    {{test_command}}

    echo "✓ Tests passed!"

# Build script
build:
  unix: |
    #!/usr/bin/env bash
    # Build script

    set -e

    echo "Building {{project_name}}..."

    # Clean previous build
    if [ -d "{{build_dir}}" ]; then
        rm -rf {{build_dir}}
    fi

    # Build
    {{build_command}}

    echo "✓ Build complete: {{build_dir}}/"

# Deploy script
deploy:
  unix: |
    #!/usr/bin/env bash
    # Deploy script

    set -e

    # Colors
    RED='\033[0;31m'
    GREEN='\033[0;32m'
    YELLOW='\033[1;33m'
    NC='\033[0m'

    ENVIRONMENT=${1:-production}

    echo -e "${GREEN}Deploying to ${ENVIRONMENT}...${NC}"

    # Check if environment exists
    if [ ! -f "config/${ENVIRONMENT}.yml" ]; then
        echo -e "${RED}Error: Environment config not found${NC}"
        exit 1
    fi

    # Build
    echo "Building..."
    {{build_command}}

    # Run tests
    echo "Running tests..."
    {{test_command}}

    # Deploy
    echo "Deploying..."
    {{deploy_command}}

    echo -e "${GREEN}✓ Deployment complete!${NC}"

# Release script
release:
  unix: |
    #!/usr/bin/env bash
    # Release script

    set -e

    # Colors
    RED='\033[0;31m'
    GREEN='\033[0;32m'
    YELLOW='\033[1;33m'
    NC='\033[0m'

    VERSION=$1

    if [ -z "$VERSION" ]; then
        echo -e "${RED}Error: Version required${NC}"
        echo "Usage: ./scripts/release.sh v1.0.0"
        exit 1
    fi

    echo -e "${GREEN}Creating release ${VERSION}...${NC}"

    # Check git status
    if [ -n "$(git status --porcelain)" ]; then
        echo -e "${RED}Error: Working directory is not clean${NC}"
        exit 1
    fi

    # Run tests
    echo "Running tests..."
    {{test_command}}

    # Update version
    echo "Updating version..."
    {{version_update_command}}

    # Build
    echo "Building..."
    {{build_command}}

    # Commit changes
    git add .
    git commit -m "chore: release ${VERSION}"

    # Create tag
    git tag -a ${VERSION} -m "Release ${VERSION}"

    # Push
    git push origin main --tags

    echo -e "${GREEN}✓ Release ${VERSION} created!${NC}"

# Docker build script
docker_build:
  unix: |
    #!/usr/bin/env bash
    # Docker build script

    set -e

    IMAGE_NAME={{docker_image}}
    TAG=${1:-latest}

    echo "Building Docker image: ${IMAGE_NAME}:${TAG}"

    docker build -t ${IMAGE_NAME}:${TAG} .

    echo "✓ Docker image built: ${IMAGE_NAME}:${TAG}"
    echo ""
    echo "To run: docker run -p 8080:8080 ${IMAGE_NAME}:${TAG}"

# Clean script
clean:
  unix: |
    #!/usr/bin/env bash
    # Clean build artifacts

    echo "Cleaning build artifacts..."

    # Remove build directories
    rm -rf {{build_dirs}}

    # Remove cache directories
    rm -rf {{cache_dirs}}

    echo "✓ Clean complete!"

# Lint script
lint:
  unix: |
    #!/usr/bin/env bash
    # Run linters

    set -e

    echo "Running linters..."

    # Run linter
    {{lint_command}}

    echo "✓ Lint passed!"

# Format script
format:
  unix: |
    #!/usr/bin/env bash
    # Format code

    echo "Formatting code..."

    # Run formatter
    {{format_command}}

    echo "✓ Format complete!"

# Dev server script
dev:
  unix: |
    #!/usr/bin/env bash
    # Start development server

    echo "Starting development server..."

    # Check dependencies
    if [ ! -d "{{deps_dir}}" ]; then
        echo "Installing dependencies..."
        {{install_command}}
    fi

    # Start server
    {{dev_command}}